#!/bin/bash
#
# StarCell.app — entry point
# Finds Python 3 and runs the launcher script inside Resources/.
#

RESOURCES="$(cd "$(dirname "$0")/../Resources" && pwd)"
LAUNCH_PY="$RESOURCES/launch.py"

# ── Locate Python 3 ──────────────────────────────────────────────────────────
PYTHON=""
for candidate in \
    /opt/homebrew/bin/python3 \
    /usr/local/bin/python3 \
    /Library/Frameworks/Python.framework/Versions/Current/bin/python3 \
    /usr/bin/python3 \
    "$(command -v python3 2>/dev/null)"; do
    if [ -x "$candidate" ] 2>/dev/null; then
        PYTHON="$candidate"
        break
    fi
done

if [ -z "$PYTHON" ]; then
    osascript -e '
        display dialog "StarCell requires Python 3.\n\nDownload it from python.org, install it, then relaunch." \
            buttons {"OK"} default button "OK" with title "StarCell — Python not found"'
    exit 1
fi

# ── Open a Terminal window and run the launcher ───────────────────────────────
# Pass STARCELL_DIR through if the caller set it.
STARCELL_DIR_ARG=""
if [ -n "$STARCELL_DIR" ]; then
    STARCELL_DIR_ARG="export STARCELL_DIR=\"$STARCELL_DIR\"; "
fi

LAUNCH_CMD="${STARCELL_DIR_ARG}\"${PYTHON}\" \"${LAUNCH_PY}\""

osascript - "$LAUNCH_CMD" <<'APPLESCRIPT'
on run {cmd}
    tell application "Terminal"
        activate
        do script cmd
    end tell
end run
APPLESCRIPT
